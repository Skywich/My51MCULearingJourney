C51 COMPILER V9.60.7.0   MAIN                                                              02/23/2026 22:03:50 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\KeilC51\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGX52.H>
   2          #include "DELAY.h"
   3          #include "LCD1602.h"
   4          #include "MATRIXKEY.H"
   5          #include "Buzzer.h"
   6          /*
   7          ------------按键说明---------------
   8          S1~9数字输入按键
   9          S13 删除
  10          S14 确定
  11          S15 复位
  12          S16 重设密码
  13          -----------------------------------
  14          */
  15          
  16          char HaltFlag=0;//标记是否处于      输入完成状态
  17          char RightFlag=0;//标记是否处于     输入正确状态
  18          char ResetModFlag=0;//标记是否处于  重设密码状态
  19          char SureFlag=0;//标记是否处于      确定重设密码状态
  20          unsigned long int InputedPassword=0,SetInputedPassword=1111,NewSetInputedPassword=0;//初始密码1111
  21          unsigned char Count=0;  
  22          unsigned int KeyNumber=0;
  23                  
  24          void IsShowSuccessStatus(char RightFlag)
  25                  //显示输入正确才显示的星星*
  26          {
  27   1              if(RightFlag==1)
  28   1              {
  29   2                      LCD_ShowChar(2,16,'*');
  30   2              }
  31   1              else if (RightFlag==0)
  32   1              {
  33   2                      LCD_ShowChar(2,16,' ');
  34   2              }       
  35   1      }       
  36          
  37          void PasswordInputStatus()
  38          {
  39   1              LCD_ShowString(2,1,"                ");
  40   1              LCD_ShowString(2,1,"                ");
  41   1              LCD_ShowString(1,1,"Enter Password:");
  42   1              LCD_ShowChar(2,1,'{');
  43   1              LCD_ShowChar(2,6,'}');
  44   1              ResetModFlag=0;
  45   1              SureFlag=0;
  46   1              Count=0;        
  47   1              HaltFlag=0;
  48   1      }
  49          
  50          void PasswordResetStatus()
  51          {
  52   1              LCD_ShowString(1,1,"                ");
  53   1              LCD_ShowString(1,1,"                "); 
  54   1              LCD_ShowString(1,1,"New Password:");
C51 COMPILER V9.60.7.0   MAIN                                                              02/23/2026 22:03:50 PAGE 2   

  55   1              LCD_ShowChar(2,1,'{');
  56   1              LCD_ShowChar(2,6,'}');
  57   1              ResetModFlag=1;
  58   1              RightFlag=0;    
  59   1              SureFlag=0;
  60   1      }
  61          
  62          void SureStatus()
  63          {
  64   1              LCD_ShowString(1,1,"                ");
  65   1              LCD_ShowString(2,1,"                "); 
  66   1              LCD_ShowString(1,1,"Sure?");
  67   1              ResetModFlag=1;
  68   1              RightFlag=0;
  69   1              SureFlag=1;
  70   1      }
  71          
  72          void Input()
  73          {
  74   1              if(Count<4 && ResetModFlag==0)//输入密码状态的输入
  75   1              {               
  76   2                      InputedPassword*=10;
  77   2                      InputedPassword+=KeyNumber;
  78   2                      LCD_ShowNum(2,2,InputedPassword,4);
  79   2                      Count++;
  80   2              }
  81   1              else if(Count<4 && ResetModFlag==1  && !SureFlag)//重设密码状态模式的输入
  82   1              {
  83   2                      NewSetInputedPassword*=10;
  84   2                      NewSetInputedPassword+=KeyNumber;
  85   2                      LCD_ShowNum(2,2,NewSetInputedPassword,4);
  86   2                      Count++;                                        
  87   2              }
  88   1      }
  89          
  90          
  91          void Comfirm_InputPassord()
  92          {
  93   1              if(InputedPassword==SetInputedPassword)//密码正确
  94   1              {
  95   2                      LCD_ShowString(1,1,"                ");
  96   2                      LCD_ShowString(2,1,"      ");
  97   2                      LCD_ShowString(1,1,"YEP!");
  98   2                      BuzzerPlay(1);
  99   2                      HaltFlag=1;
 100   2                      RightFlag=1;
 101   2              }
 102   1              else//密码错误
 103   1              {
 104   2                      LCD_ShowString(1,1,"                ");
 105   2                      LCD_ShowString(2,1,"      ");
 106   2                      LCD_ShowString(1,1,"NOPE!");
 107   2                      BuzzerPlay(0);
 108   2                      HaltFlag=1;
 109   2                      RightFlag=0;
 110   2              }
 111   1      }
 112          
 113          void Comfirm_Resetpassword()
 114          {
 115   1              if(SureFlag==0)//不处于确定重设状态的确定
 116   1              {
C51 COMPILER V9.60.7.0   MAIN                                                              02/23/2026 22:03:50 PAGE 3   

 117   2                      SureStatus();
 118   2              }
 119   1              else if(SureFlag==1)//处于确定重设状态的确定
 120   1              {
 121   2                      SetInputedPassword = NewSetInputedPassword;
 122   2                      NewSetInputedPassword=0;
 123   2                      PasswordInputStatus();
 124   2              }
 125   1      }
 126          
 127          void Comfirm()
 128          {
 129   1              if(!ResetModFlag)//输入密码状态的确定
 130   1              {
 131   2                      Comfirm_InputPassord();
 132   2              }
 133   1              else //重设密码状态的确定
 134   1              {
 135   2                      Comfirm_Resetpassword();
 136   2              }
 137   1      }
 138          
 139          
 140          void Delete_Input()
 141          {
 142   1              InputedPassword/=10;
 143   1              LCD_ShowNum(2,2,InputedPassword,4);
 144   1              if(Count>0)
 145   1              {
 146   2                      Count--;
 147   2              }       
 148   1      }
 149          
 150          void Delete_Reset_BeforeSure()
 151          {
 152   1              NewSetInputedPassword/=10;
 153   1              LCD_ShowNum(2,2,NewSetInputedPassword,4);
 154   1              if(Count>0)
 155   1              {
 156   2                      Count--;
 157   2              }       
 158   1              else if(Count==0)//删除到零了就返回上一级状态:密码输入状态
 159   1              {
 160   2                      PasswordInputStatus();
 161   2                      RightFlag=1;
 162   2              }
 163   1      }
 164          
 165          void Delete_Reset_Sure()
 166          {
 167   1              PasswordResetStatus();
 168   1              LCD_ShowNum(2,2,NewSetInputedPassword,4);
 169   1      }
 170          
 171          void Delete_Reset()
 172          {
 173   1              if(SureFlag==0)//重设密码输入状态的删除
 174   1              {
 175   2                      Delete_Reset_BeforeSure();
 176   2              }
 177   1              else//重设密码确定状态的删除：直接返回上一级状态
 178   1              {
C51 COMPILER V9.60.7.0   MAIN                                                              02/23/2026 22:03:50 PAGE 4   

 179   2                      Delete_Reset_Sure();
 180   2              }
 181   1      }
 182          
 183          
 184          
 185          void Delete()
 186          {
 187   1              if(ResetModFlag==0)//密码输入状态的删除
 188   1              {
 189   2                      Delete_Input();
 190   2              }
 191   1              else//重设密码状态的删除
 192   1              {
 193   2                      Delete_Reset();
 194   2              }
 195   1      
 196   1      }
 197          
 198          void Restart()
 199          {
 200   1              if(ResetModFlag==0)
 201   1              {
 202   2                      InputedPassword=0;
 203   2                      PasswordInputStatus();  
 204   2              }
 205   1              else 
 206   1              {
 207   2                      //复位在其他状态无效
 208   2              }
 209   1      
 210   1      }
 211          
 212          
 213          void main()
 214          {
 215   1      
 216   1              //初始化
 217   1              LCD_Init();
 218   1              PasswordInputStatus();
 219   1              
 220   1              while(1)
 221   1              {
 222   2                      KeyNumber = MatrixKey();//获取按键
 223   2                      
 224   2                      IsShowSuccessStatus(RightFlag);
 225   2                      
 226   2                      if(!HaltFlag)//处于非输入完成状态时，才可以进行除了复位以外的操作
 227   2                      {
 228   3                              
 229   3                              //进入重设密码状态
 230   3                              if(KeyNumber==16 && RightFlag==1)
 231   3                              {
 232   4                                      PasswordResetStatus();
 233   4                                      LCD_ShowNum(2,2,0,4);
 234   4                                      Count=0;
 235   4                              }
 236   3      
 237   3                              //输入
 238   3                              if(KeyNumber<=9 && KeyNumber>0)
 239   3                              {
 240   4                                      Input();
C51 COMPILER V9.60.7.0   MAIN                                                              02/23/2026 22:03:50 PAGE 5   

 241   4                              }
 242   3                              
 243   3                              //确定
 244   3                              if(KeyNumber==14)
 245   3                              {
 246   4                                      Comfirm();
 247   4                              }
 248   3                              
 249   3                              //删除
 250   3                              if(KeyNumber==13)
 251   3                              {
 252   4                                      Delete();
 253   4                                      
 254   4                              }
 255   3                              
 256   3                      }
 257   2                      
 258   2                      //复位 ： 只在密码输入完成状态有效
 259   2                      else 
 260   2                              if(KeyNumber==15)
 261   2                              {
 262   3                                      Restart();
 263   3                              }
 264   2                      
 265   2                      
 266   2                      
 267   2                      
 268   2                      
 269   2              }
 270   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    797    ----
   CONSTANT SIZE    =     71    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     19       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
